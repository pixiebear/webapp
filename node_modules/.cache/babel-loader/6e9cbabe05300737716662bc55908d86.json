{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/nikola/Sites/candy-machine/candy-machine-ui/node_modules/@babel/runtime/regenerator/index.js\");\n\nvar _asyncToGenerator = require(\"/Users/nikola/Sites/candy-machine/candy-machine-ui/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar react_1 = require(\"react\");\n\nvar logger_1 = __importDefault(require(\"../logger\"));\n\nvar useWalletHooks_1 = __importDefault(require(\"./useWalletHooks\"));\n\nvar usePowo = function usePowo(_ref, state, dispatch) {\n  var wallet = _ref.wallet,\n      chainImplementation = _ref.chainImplementation;\n  var powoFinished = state.powoFinished,\n      walletPowoInProgress = state.walletPowoInProgress,\n      refreshInProgress = state.refreshInProgress;\n\n  var _ref2 = (0, useWalletHooks_1.default)(wallet, state, dispatch),\n      expectWalletConnected = _ref2.expectWalletConnected;\n  /**\n   * wait until the user has confirmed they want to continue the proof of wallet ownership flow\n   * then resolve the promise\n   */\n\n\n  var waitForConfirmPOWO = (0, react_1.useCallback)(\n  /*#__PURE__*/\n  // eslint-disable-next-line @typescript-eslint/no-shadow\n  function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(payload) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              logger_1.default.debug('usePowo waitForConfirmPOWO before expectWalletConnected', {\n                payload: payload\n              });\n              expectWalletConnected();\n              return _context.abrupt(\"return\", new Promise(function (resolve) {\n                logger_1.default.debug('usePowo waitForConfirmPOWO', {\n                  powoFinished: powoFinished\n                });\n\n                if (powoFinished) {\n                  resolve(payload);\n                }\n              }));\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }(), [powoFinished, expectWalletConnected]);\n  /**\n   * wait until the user has provided proof of wallet ownership using their connected wallet\n   * if this was triggered from the refresh flow, dispatch events to indicate progress\n   * if not, resolve a promise when the proof is ready\n   */\n\n  var waitForPOWO = (0, react_1.useCallback)( /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2( // eslint-disable-next-line @typescript-eslint/no-shadow\n    payload) {\n      var connectedWallet;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              logger_1.default.debug('usePowo waitForPOWO before expectWalletConnected');\n              connectedWallet = expectWalletConnected();\n\n              if (!connectedWallet) {\n                _context2.next = 5;\n                break;\n              }\n\n              logger_1.default.debug('usePowo waitForPOWO', {\n                payload: payload,\n                publicKey: connectedWallet.publicKey\n              });\n              return _context2.abrupt(\"return\", new Promise(function (resolve) {\n                logger_1.default.debug('usePowo waitForPOWO walletPowoInProgress', {\n                  walletPowoInProgress: walletPowoInProgress,\n                  refreshInProgress: refreshInProgress\n                });\n                chainImplementation.proveWalletOwnership().then(function (proof) {\n                  resolve({\n                    proof: proof,\n                    payload: payload\n                  });\n                  dispatch({\n                    type: 'walletPowoComplete'\n                  });\n                  dispatch({\n                    type: 'civicPass_check_token_status'\n                  });\n                }).catch(function (error) {\n                  logger_1.default.error('Proof of wallet ownership error: ', error);\n                  dispatch({\n                    type: 'walletPowoIncomplete'\n                  });\n                });\n              }));\n\n            case 5:\n              return _context2.abrupt(\"return\", {});\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x2) {\n      return _ref4.apply(this, arguments);\n    };\n  }(), [expectWalletConnected, walletPowoInProgress, chainImplementation]);\n  var waitForHandleTransaction = (0, react_1.useCallback)( /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(transaction) {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return chainImplementation.handleUserSignedTransaction(transaction);\n\n            case 2:\n              dispatch({\n                type: 'walletPowoComplete'\n              });\n              dispatch({\n                type: 'civicPass_check_token_status'\n              });\n\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function (_x3) {\n      return _ref5.apply(this, arguments);\n    };\n  }(), [walletPowoInProgress, chainImplementation]);\n  return {\n    waitForConfirmPOWO: waitForConfirmPOWO,\n    waitForHandleTransaction: waitForHandleTransaction,\n    waitForPOWO: waitForPOWO\n  };\n};\n\nexports.default = usePowo;","map":{"version":3,"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","react_1","require","logger_1","useWalletHooks_1","usePowo","state","dispatch","wallet","chainImplementation","powoFinished","walletPowoInProgress","refreshInProgress","default","expectWalletConnected","waitForConfirmPOWO","useCallback","payload","debug","Promise","resolve","waitForPOWO","connectedWallet","publicKey","proveWalletOwnership","then","proof","type","catch","error","waitForHandleTransaction","transaction","handleUserSignedTransaction"],"sources":["/Users/nikola/Sites/candy-machine/candy-machine-ui/node_modules/@civic/solana-gateway-react/dist/esm/useHooks/usePOWO.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst react_1 = require(\"react\");\nconst logger_1 = __importDefault(require(\"../logger\"));\nconst useWalletHooks_1 = __importDefault(require(\"./useWalletHooks\"));\nconst usePowo = ({ wallet, chainImplementation }, state, dispatch) => {\n    const { powoFinished, walletPowoInProgress, refreshInProgress } = state;\n    const { expectWalletConnected } = (0, useWalletHooks_1.default)(wallet, state, dispatch);\n    /**\n     * wait until the user has confirmed they want to continue the proof of wallet ownership flow\n     * then resolve the promise\n     */\n    const waitForConfirmPOWO = (0, react_1.useCallback)(\n    // eslint-disable-next-line @typescript-eslint/no-shadow\n    async (payload) => {\n        logger_1.default.debug('usePowo waitForConfirmPOWO before expectWalletConnected', {\n            payload,\n        });\n        expectWalletConnected();\n        return new Promise((resolve) => {\n            logger_1.default.debug('usePowo waitForConfirmPOWO', { powoFinished });\n            if (powoFinished) {\n                resolve(payload);\n            }\n        });\n    }, [powoFinished, expectWalletConnected]);\n    /**\n     * wait until the user has provided proof of wallet ownership using their connected wallet\n     * if this was triggered from the refresh flow, dispatch events to indicate progress\n     * if not, resolve a promise when the proof is ready\n     */\n    const waitForPOWO = (0, react_1.useCallback)(async (\n    // eslint-disable-next-line @typescript-eslint/no-shadow\n    payload) => {\n        logger_1.default.debug('usePowo waitForPOWO before expectWalletConnected');\n        const connectedWallet = expectWalletConnected();\n        if (connectedWallet) {\n            logger_1.default.debug('usePowo waitForPOWO', {\n                payload,\n                publicKey: connectedWallet.publicKey,\n            });\n            return new Promise((resolve) => {\n                logger_1.default.debug('usePowo waitForPOWO walletPowoInProgress', {\n                    walletPowoInProgress,\n                    refreshInProgress,\n                });\n                chainImplementation\n                    .proveWalletOwnership()\n                    .then((proof) => {\n                    resolve({ proof, payload });\n                    dispatch({ type: 'walletPowoComplete' });\n                    dispatch({ type: 'civicPass_check_token_status' });\n                })\n                    .catch((error) => {\n                    logger_1.default.error('Proof of wallet ownership error: ', error);\n                    dispatch({ type: 'walletPowoIncomplete' });\n                });\n            });\n        }\n        return {};\n    }, [expectWalletConnected, walletPowoInProgress, chainImplementation]);\n    const waitForHandleTransaction = (0, react_1.useCallback)(async (transaction) => {\n        await chainImplementation.handleUserSignedTransaction(transaction);\n        dispatch({ type: 'walletPowoComplete' });\n        dispatch({ type: 'civicPass_check_token_status' });\n    }, [walletPowoInProgress, chainImplementation]);\n    return {\n        waitForConfirmPOWO,\n        waitForHandleTransaction,\n        waitForPOWO,\n    };\n};\nexports.default = usePowo;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}