{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst react_1 = require(\"react\");\n\nconst logger_1 = __importDefault(require(\"../logger\"));\n\nconst useWalletHooks_1 = __importDefault(require(\"./useWalletHooks\"));\n\nconst usePowo = (_ref, state, dispatch) => {\n  let {\n    wallet,\n    chainImplementation\n  } = _ref;\n  const {\n    powoFinished,\n    walletPowoInProgress,\n    refreshInProgress\n  } = state;\n  const {\n    expectWalletConnected\n  } = (0, useWalletHooks_1.default)(wallet, state, dispatch);\n  /**\n   * wait until the user has confirmed they want to continue the proof of wallet ownership flow\n   * then resolve the promise\n   */\n\n  const waitForConfirmPOWO = (0, react_1.useCallback)( // eslint-disable-next-line @typescript-eslint/no-shadow\n  async payload => {\n    logger_1.default.debug('usePowo waitForConfirmPOWO before expectWalletConnected', {\n      payload\n    });\n    expectWalletConnected();\n    return new Promise(resolve => {\n      logger_1.default.debug('usePowo waitForConfirmPOWO', {\n        powoFinished\n      });\n\n      if (powoFinished) {\n        resolve(payload);\n      }\n    });\n  }, [powoFinished, expectWalletConnected]);\n  /**\n   * wait until the user has provided proof of wallet ownership using their connected wallet\n   * if this was triggered from the refresh flow, dispatch events to indicate progress\n   * if not, resolve a promise when the proof is ready\n   */\n\n  const waitForPOWO = (0, react_1.useCallback)(async ( // eslint-disable-next-line @typescript-eslint/no-shadow\n  payload) => {\n    logger_1.default.debug('usePowo waitForPOWO before expectWalletConnected');\n    const connectedWallet = expectWalletConnected();\n\n    if (connectedWallet) {\n      logger_1.default.debug('usePowo waitForPOWO', {\n        payload,\n        publicKey: connectedWallet.publicKey\n      });\n      return new Promise(resolve => {\n        logger_1.default.debug('usePowo waitForPOWO walletPowoInProgress', {\n          walletPowoInProgress,\n          refreshInProgress\n        });\n        chainImplementation.proveWalletOwnership().then(proof => {\n          resolve({\n            proof,\n            payload\n          });\n          dispatch({\n            type: 'walletPowoComplete'\n          });\n          dispatch({\n            type: 'civicPass_check_token_status'\n          });\n        }).catch(error => {\n          logger_1.default.error('Proof of wallet ownership error: ', error);\n          dispatch({\n            type: 'walletPowoIncomplete'\n          });\n        });\n      });\n    }\n\n    return {};\n  }, [expectWalletConnected, walletPowoInProgress, chainImplementation]);\n  const waitForHandleTransaction = (0, react_1.useCallback)(async transaction => {\n    await chainImplementation.handleUserSignedTransaction(transaction);\n    dispatch({\n      type: 'walletPowoComplete'\n    });\n    dispatch({\n      type: 'civicPass_check_token_status'\n    });\n  }, [walletPowoInProgress, chainImplementation]);\n  return {\n    waitForConfirmPOWO,\n    waitForHandleTransaction,\n    waitForPOWO\n  };\n};\n\nexports.default = usePowo;","map":{"version":3,"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","react_1","require","logger_1","useWalletHooks_1","usePowo","state","dispatch","wallet","chainImplementation","powoFinished","walletPowoInProgress","refreshInProgress","expectWalletConnected","default","waitForConfirmPOWO","useCallback","payload","debug","Promise","resolve","waitForPOWO","connectedWallet","publicKey","proveWalletOwnership","then","proof","type","catch","error","waitForHandleTransaction","transaction","handleUserSignedTransaction"],"sources":["/Users/nikola/Sites/candy-machine/candy-machine-ui/node_modules/@civic/solana-gateway-react/dist/esm/useHooks/usePOWO.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst react_1 = require(\"react\");\nconst logger_1 = __importDefault(require(\"../logger\"));\nconst useWalletHooks_1 = __importDefault(require(\"./useWalletHooks\"));\nconst usePowo = ({ wallet, chainImplementation }, state, dispatch) => {\n    const { powoFinished, walletPowoInProgress, refreshInProgress } = state;\n    const { expectWalletConnected } = (0, useWalletHooks_1.default)(wallet, state, dispatch);\n    /**\n     * wait until the user has confirmed they want to continue the proof of wallet ownership flow\n     * then resolve the promise\n     */\n    const waitForConfirmPOWO = (0, react_1.useCallback)(\n    // eslint-disable-next-line @typescript-eslint/no-shadow\n    async (payload) => {\n        logger_1.default.debug('usePowo waitForConfirmPOWO before expectWalletConnected', {\n            payload,\n        });\n        expectWalletConnected();\n        return new Promise((resolve) => {\n            logger_1.default.debug('usePowo waitForConfirmPOWO', { powoFinished });\n            if (powoFinished) {\n                resolve(payload);\n            }\n        });\n    }, [powoFinished, expectWalletConnected]);\n    /**\n     * wait until the user has provided proof of wallet ownership using their connected wallet\n     * if this was triggered from the refresh flow, dispatch events to indicate progress\n     * if not, resolve a promise when the proof is ready\n     */\n    const waitForPOWO = (0, react_1.useCallback)(async (\n    // eslint-disable-next-line @typescript-eslint/no-shadow\n    payload) => {\n        logger_1.default.debug('usePowo waitForPOWO before expectWalletConnected');\n        const connectedWallet = expectWalletConnected();\n        if (connectedWallet) {\n            logger_1.default.debug('usePowo waitForPOWO', {\n                payload,\n                publicKey: connectedWallet.publicKey,\n            });\n            return new Promise((resolve) => {\n                logger_1.default.debug('usePowo waitForPOWO walletPowoInProgress', {\n                    walletPowoInProgress,\n                    refreshInProgress,\n                });\n                chainImplementation\n                    .proveWalletOwnership()\n                    .then((proof) => {\n                    resolve({ proof, payload });\n                    dispatch({ type: 'walletPowoComplete' });\n                    dispatch({ type: 'civicPass_check_token_status' });\n                })\n                    .catch((error) => {\n                    logger_1.default.error('Proof of wallet ownership error: ', error);\n                    dispatch({ type: 'walletPowoIncomplete' });\n                });\n            });\n        }\n        return {};\n    }, [expectWalletConnected, walletPowoInProgress, chainImplementation]);\n    const waitForHandleTransaction = (0, react_1.useCallback)(async (transaction) => {\n        await chainImplementation.handleUserSignedTransaction(transaction);\n        dispatch({ type: 'walletPowoComplete' });\n        dispatch({ type: 'civicPass_check_token_status' });\n    }, [walletPowoInProgress, chainImplementation]);\n    return {\n        waitForConfirmPOWO,\n        waitForHandleTransaction,\n        waitForPOWO,\n    };\n};\nexports.default = usePowo;\n"],"mappings":"AAAA;;AACA,IAAIA,eAAe,GAAI,QAAQ,KAAKA,eAAd,IAAkC,UAAUC,GAAV,EAAe;EACnE,OAAQA,GAAG,IAAIA,GAAG,CAACC,UAAZ,GAA0BD,GAA1B,GAAgC;IAAE,WAAWA;EAAb,CAAvC;AACH,CAFD;;AAGAE,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;EAAEC,KAAK,EAAE;AAAT,CAA7C;;AACA,MAAMC,OAAO,GAAGC,OAAO,CAAC,OAAD,CAAvB;;AACA,MAAMC,QAAQ,GAAGT,eAAe,CAACQ,OAAO,CAAC,WAAD,CAAR,CAAhC;;AACA,MAAME,gBAAgB,GAAGV,eAAe,CAACQ,OAAO,CAAC,kBAAD,CAAR,CAAxC;;AACA,MAAMG,OAAO,GAAG,OAAkCC,KAAlC,EAAyCC,QAAzC,KAAsD;EAAA,IAArD;IAAEC,MAAF;IAAUC;EAAV,CAAqD;EAClE,MAAM;IAAEC,YAAF;IAAgBC,oBAAhB;IAAsCC;EAAtC,IAA4DN,KAAlE;EACA,MAAM;IAAEO;EAAF,IAA4B,CAAC,GAAGT,gBAAgB,CAACU,OAArB,EAA8BN,MAA9B,EAAsCF,KAAtC,EAA6CC,QAA7C,CAAlC;EACA;AACJ;AACA;AACA;;EACI,MAAMQ,kBAAkB,GAAG,CAAC,GAAGd,OAAO,CAACe,WAAZ,GAC3B;EACA,MAAOC,OAAP,IAAmB;IACfd,QAAQ,CAACW,OAAT,CAAiBI,KAAjB,CAAuB,yDAAvB,EAAkF;MAC9ED;IAD8E,CAAlF;IAGAJ,qBAAqB;IACrB,OAAO,IAAIM,OAAJ,CAAaC,OAAD,IAAa;MAC5BjB,QAAQ,CAACW,OAAT,CAAiBI,KAAjB,CAAuB,4BAAvB,EAAqD;QAAER;MAAF,CAArD;;MACA,IAAIA,YAAJ,EAAkB;QACdU,OAAO,CAACH,OAAD,CAAP;MACH;IACJ,CALM,CAAP;EAMH,CAb0B,EAaxB,CAACP,YAAD,EAAeG,qBAAf,CAbwB,CAA3B;EAcA;AACJ;AACA;AACA;AACA;;EACI,MAAMQ,WAAW,GAAG,CAAC,GAAGpB,OAAO,CAACe,WAAZ,EAAyB,QAC7C;EACAC,OAF6C,KAEjC;IACRd,QAAQ,CAACW,OAAT,CAAiBI,KAAjB,CAAuB,kDAAvB;IACA,MAAMI,eAAe,GAAGT,qBAAqB,EAA7C;;IACA,IAAIS,eAAJ,EAAqB;MACjBnB,QAAQ,CAACW,OAAT,CAAiBI,KAAjB,CAAuB,qBAAvB,EAA8C;QAC1CD,OAD0C;QAE1CM,SAAS,EAAED,eAAe,CAACC;MAFe,CAA9C;MAIA,OAAO,IAAIJ,OAAJ,CAAaC,OAAD,IAAa;QAC5BjB,QAAQ,CAACW,OAAT,CAAiBI,KAAjB,CAAuB,0CAAvB,EAAmE;UAC/DP,oBAD+D;UAE/DC;QAF+D,CAAnE;QAIAH,mBAAmB,CACde,oBADL,GAEKC,IAFL,CAEWC,KAAD,IAAW;UACjBN,OAAO,CAAC;YAAEM,KAAF;YAAST;UAAT,CAAD,CAAP;UACAV,QAAQ,CAAC;YAAEoB,IAAI,EAAE;UAAR,CAAD,CAAR;UACApB,QAAQ,CAAC;YAAEoB,IAAI,EAAE;UAAR,CAAD,CAAR;QACH,CAND,EAOKC,KAPL,CAOYC,KAAD,IAAW;UAClB1B,QAAQ,CAACW,OAAT,CAAiBe,KAAjB,CAAuB,mCAAvB,EAA4DA,KAA5D;UACAtB,QAAQ,CAAC;YAAEoB,IAAI,EAAE;UAAR,CAAD,CAAR;QACH,CAVD;MAWH,CAhBM,CAAP;IAiBH;;IACD,OAAO,EAAP;EACH,CA7BmB,EA6BjB,CAACd,qBAAD,EAAwBF,oBAAxB,EAA8CF,mBAA9C,CA7BiB,CAApB;EA8BA,MAAMqB,wBAAwB,GAAG,CAAC,GAAG7B,OAAO,CAACe,WAAZ,EAAyB,MAAOe,WAAP,IAAuB;IAC7E,MAAMtB,mBAAmB,CAACuB,2BAApB,CAAgDD,WAAhD,CAAN;IACAxB,QAAQ,CAAC;MAAEoB,IAAI,EAAE;IAAR,CAAD,CAAR;IACApB,QAAQ,CAAC;MAAEoB,IAAI,EAAE;IAAR,CAAD,CAAR;EACH,CAJgC,EAI9B,CAAChB,oBAAD,EAAuBF,mBAAvB,CAJ8B,CAAjC;EAKA,OAAO;IACHM,kBADG;IAEHe,wBAFG;IAGHT;EAHG,CAAP;AAKH,CAlED;;AAmEAtB,OAAO,CAACe,OAAR,GAAkBT,OAAlB"},"metadata":{},"sourceType":"script"}