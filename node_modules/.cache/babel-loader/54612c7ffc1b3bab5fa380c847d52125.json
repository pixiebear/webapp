{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.reducer = exports.combineReducers = void 0;\n\nconst logger_1 = __importDefault(require(\"../logger\"));\n\nconst types_1 = require(\"../types\");\n\nconst utils_1 = require(\"./utils\");\n\nconst combineReducers = function () {\n  for (var _len = arguments.length, reducers = new Array(_len), _key = 0; _key < _len; _key++) {\n    reducers[_key] = arguments[_key];\n  }\n\n  return (state, action) => reducers.reduce((newState, reducer) => reducer(newState, action), state);\n};\n\nexports.combineReducers = combineReducers;\n\nconst reducer = (state, action) => {\n  var _a;\n\n  const gatewayStatus = (0, utils_1.statusFromToken)(state, state.gatewayToken) || types_1.GatewayStatus.UNKNOWN;\n  const updatedState = Object.assign(Object.assign({}, state), {\n    gatewayStatus\n  }); // eslint-disable-next-line no-prototype-builtins\n\n  const tokenCreationInProgress = !!((_a = updatedState.civicPass.responsePayload) === null || _a === void 0 ? void 0 : _a.hasOwnProperty(types_1.CivicPassMessageAction.ISSUANCE));\n  logger_1.default.debug(`reducer.action: ${action.type}`, types_1.GatewayStatus[updatedState.gatewayStatus]);\n\n  switch (action.type) {\n    case 'startWalletPowo':\n      {\n        return Object.assign(Object.assign({}, updatedState), {\n          walletPowoInProgress: true\n        });\n      }\n\n    case 'walletPowoComplete':\n      {\n        logger_1.default.debug('tokenCreationInProgress', {\n          tokenCreationInProgress\n        });\n        return Object.assign(Object.assign({}, updatedState), {\n          // only move to IN_REVIEW if it's during the initial token creation flow\n          gatewayStatus: tokenCreationInProgress ? types_1.GatewayStatus.IN_REVIEW : updatedState.gatewayStatus,\n          walletPowoInProgress: false,\n          firstTokenCheck: false\n        });\n      }\n\n    case 'walletPowoIncomplete':\n      {\n        logger_1.default.debug('tokenCreationInProgress', {\n          tokenCreationInProgress\n        });\n        return Object.assign(Object.assign({}, state), {\n          renderIframe: false,\n          iframeMinimized: true,\n          powoFinished: false,\n          refreshTokenState: types_1.RefreshTokenState.IN_PROGRESS\n        });\n      }\n\n    case 'tokenChange':\n      return Object.assign(Object.assign({}, state), {\n        gatewayStatus: (0, utils_1.statusFromToken)(state, action.token),\n        powoFinished: false,\n        gatewayToken: action.token,\n        tokenIssuanceState: types_1.TokenIssuanceState.COMPLETED\n      });\n\n    case 'powoComplete':\n      return Object.assign(Object.assign({}, updatedState), {\n        gatewayStatus: types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP,\n        powoFinished: true,\n        powoRequested: undefined,\n        refreshTimeoutId: undefined,\n        refreshTokenState: state.refreshTokenState === types_1.RefreshTokenState.IN_PROGRESS ? types_1.RefreshTokenState.REQUIRES_POWO : state.refreshTokenState\n      });\n\n    case 'walletDisconnected':\n      return (0, utils_1.resetState)(state);\n\n    case 'requestGatekeeperIssuance':\n      return Object.assign(Object.assign({}, updatedState), {\n        powoFinished: false,\n        walletPowoInProgress: false,\n        tokenIssuanceState: types_1.TokenIssuanceState.IN_PROGRESS\n      });\n\n    case 'requestGatekeeperIssuanceComplete':\n      return Object.assign(Object.assign({}, updatedState), {\n        tokenIssuanceState: types_1.TokenIssuanceState.COMPLETED,\n        gatewayTokenTransaction: action.gatewayTokenTransaction,\n        civicPass: Object.assign(Object.assign({}, updatedState.civicPass), {\n          responsePayload: undefined\n        })\n      });\n\n    case 'requestGatekeeperIssuanceFailed':\n      return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), {\n        gatewayStatus: types_1.GatewayStatus.ERROR,\n        tokenIssuanceState: types_1.TokenIssuanceState.FAILED\n      });\n\n    case 'refreshAttemptDone':\n      return Object.assign(Object.assign({}, updatedState), {\n        refreshInProgress: false\n      });\n\n    case 'updateStateWithProps':\n      return Object.assign(Object.assign({}, state), {\n        stage: action.stage,\n        walletAddress: action.walletAddress,\n        redirectUrl: action.redirectUrl,\n        gatekeeperNetworkAddress: action.gatekeeperNetworkAddress,\n        ownerSigns: action.ownerSigns\n      });\n\n    case 'tokenNotFoundError':\n      return Object.assign(Object.assign({}, state), {\n        renderIframe: false,\n        iframeMinimized: true,\n        gatewayStatus: types_1.GatewayStatus.ERROR\n      });\n\n    case 'gatekeeperNetworkChanged':\n      return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), {\n        gatekeeperNetworkAddress: action.gatekeeperNetworkAddress,\n        walletAddress: state.walletAddress\n      });\n\n    default:\n      return state;\n  }\n};\n\nexports.reducer = reducer;","map":{"version":3,"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","reducer","combineReducers","logger_1","require","types_1","utils_1","reducers","state","action","reduce","newState","_a","gatewayStatus","statusFromToken","gatewayToken","GatewayStatus","UNKNOWN","updatedState","assign","tokenCreationInProgress","civicPass","responsePayload","hasOwnProperty","CivicPassMessageAction","ISSUANCE","default","debug","type","walletPowoInProgress","IN_REVIEW","firstTokenCheck","renderIframe","iframeMinimized","powoFinished","refreshTokenState","RefreshTokenState","IN_PROGRESS","token","tokenIssuanceState","TokenIssuanceState","COMPLETED","PROOF_OF_WALLET_OWNERSHIP","powoRequested","undefined","refreshTimeoutId","REQUIRES_POWO","resetState","gatewayTokenTransaction","ERROR","FAILED","refreshInProgress","stage","walletAddress","redirectUrl","gatekeeperNetworkAddress","ownerSigns"],"sources":["/Users/nikola/Sites/candy-machine/candy-machine-ui/node_modules/@civic/solana-gateway-react/dist/esm/useReducer/reducer.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.reducer = exports.combineReducers = void 0;\nconst logger_1 = __importDefault(require(\"../logger\"));\nconst types_1 = require(\"../types\");\nconst utils_1 = require(\"./utils\");\nconst combineReducers = (...reducers) => (state, action) => reducers.reduce((newState, reducer) => reducer(newState, action), state);\nexports.combineReducers = combineReducers;\nconst reducer = (state, action) => {\n    var _a;\n    const gatewayStatus = (0, utils_1.statusFromToken)(state, state.gatewayToken) || types_1.GatewayStatus.UNKNOWN;\n    const updatedState = Object.assign(Object.assign({}, state), { gatewayStatus });\n    // eslint-disable-next-line no-prototype-builtins\n    const tokenCreationInProgress = !!((_a = updatedState.civicPass.responsePayload) === null || _a === void 0 ? void 0 : _a.hasOwnProperty(types_1.CivicPassMessageAction.ISSUANCE));\n    logger_1.default.debug(`reducer.action: ${action.type}`, types_1.GatewayStatus[updatedState.gatewayStatus]);\n    switch (action.type) {\n        case 'startWalletPowo': {\n            return Object.assign(Object.assign({}, updatedState), { walletPowoInProgress: true });\n        }\n        case 'walletPowoComplete': {\n            logger_1.default.debug('tokenCreationInProgress', { tokenCreationInProgress });\n            return Object.assign(Object.assign({}, updatedState), { \n                // only move to IN_REVIEW if it's during the initial token creation flow\n                gatewayStatus: tokenCreationInProgress ? types_1.GatewayStatus.IN_REVIEW : updatedState.gatewayStatus, walletPowoInProgress: false, firstTokenCheck: false });\n        }\n        case 'walletPowoIncomplete': {\n            logger_1.default.debug('tokenCreationInProgress', { tokenCreationInProgress });\n            return Object.assign(Object.assign({}, state), { renderIframe: false, iframeMinimized: true, powoFinished: false, refreshTokenState: types_1.RefreshTokenState.IN_PROGRESS });\n        }\n        case 'tokenChange':\n            return Object.assign(Object.assign({}, state), { gatewayStatus: (0, utils_1.statusFromToken)(state, action.token), powoFinished: false, gatewayToken: action.token, tokenIssuanceState: types_1.TokenIssuanceState.COMPLETED });\n        case 'powoComplete':\n            return Object.assign(Object.assign({}, updatedState), { gatewayStatus: types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP, powoFinished: true, powoRequested: undefined, refreshTimeoutId: undefined, refreshTokenState: state.refreshTokenState === types_1.RefreshTokenState.IN_PROGRESS\n                    ? types_1.RefreshTokenState.REQUIRES_POWO\n                    : state.refreshTokenState });\n        case 'walletDisconnected':\n            return (0, utils_1.resetState)(state);\n        case 'requestGatekeeperIssuance':\n            return Object.assign(Object.assign({}, updatedState), { powoFinished: false, walletPowoInProgress: false, tokenIssuanceState: types_1.TokenIssuanceState.IN_PROGRESS });\n        case 'requestGatekeeperIssuanceComplete':\n            return Object.assign(Object.assign({}, updatedState), { tokenIssuanceState: types_1.TokenIssuanceState.COMPLETED, gatewayTokenTransaction: action.gatewayTokenTransaction, civicPass: Object.assign(Object.assign({}, updatedState.civicPass), { responsePayload: undefined }) });\n        case 'requestGatekeeperIssuanceFailed':\n            return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), { gatewayStatus: types_1.GatewayStatus.ERROR, tokenIssuanceState: types_1.TokenIssuanceState.FAILED });\n        case 'refreshAttemptDone':\n            return Object.assign(Object.assign({}, updatedState), { refreshInProgress: false });\n        case 'updateStateWithProps':\n            return Object.assign(Object.assign({}, state), { stage: action.stage, walletAddress: action.walletAddress, redirectUrl: action.redirectUrl, gatekeeperNetworkAddress: action.gatekeeperNetworkAddress, ownerSigns: action.ownerSigns });\n        case 'tokenNotFoundError':\n            return Object.assign(Object.assign({}, state), { renderIframe: false, iframeMinimized: true, gatewayStatus: types_1.GatewayStatus.ERROR });\n        case 'gatekeeperNetworkChanged':\n            return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), { gatekeeperNetworkAddress: action.gatekeeperNetworkAddress, walletAddress: state.walletAddress });\n        default:\n            return state;\n    }\n};\nexports.reducer = reducer;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}